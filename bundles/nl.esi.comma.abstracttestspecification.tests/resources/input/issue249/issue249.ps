import "issue249.types"
specification issue249
{
    system ContextIssueProducer
    {
        //inputs
        
        outputs
        ProdCons1		part1
        ProdCons2		part2
    
        local
        ProdReport	report
        ProdCons1	message
        ProdCtx	configuration
        ProdCtx	Event_1p0urs4
        ProdCtx	Event_0m7n0r6
        ProdCtx	between_Start_and_ComposeContext
        ProdCtx	between_ComposeContext_and_RunContext
        ProdCtx	between_RunContext_and_ComposeLocal
        ProdCtx	between_ComposeLocal_and_RunLocal
        ProdCtx	between_RunLocal_and_Compose
    
        init
        Event_1p0urs4 := ProdCtx {
         prod_field = "Hello Consumer!",
         id = 0
        }
        configuration := ProdCtx {
         prod_field = " Conf",
         id = 0
        }
    
    
        desc "ContextIssueProducer_Model"
        
        action			Compose
        element-label	"Compose"
        case			default step-type "null" action-type COMPOSE
        with-inputs		between_RunLocal_and_Compose
        produces-outputs	Event_0m7n0r6 suppress(Event_0m7n0r6.id)
        updates:
            Event_0m7n0r6 := between_RunLocal_and_Compose
        produces-outputs	part1 symbolic-link suppress(part1.id)
        updates:
            part1 := ProdCons1 {
             part1 = between_RunLocal_and_Compose.prod_field + "_1",
             id = between_RunLocal_and_Compose.id
            }
        produces-outputs	report
        updates:
            report := ProdReport { id = between_RunLocal_and_Compose.id }
        produces-outputs	part2 symbolic-link suppress(part2.id)
        updates:
            part2 := ProdCons2 {
             part2 = between_RunLocal_and_Compose.prod_field + "_2",
             id = between_RunLocal_and_Compose.id
            }
        
        action			RunContext
        element-label	"Run Context"
        case			default step-type "ProducerRunType" action-type RUN
        with-inputs		between_ComposeContext_and_RunContext
        produces-outputs	between_RunContext_and_ComposeLocal suppress(between_RunContext_and_ComposeLocal.id)
        updates:
            between_RunContext_and_ComposeLocal := between_ComposeContext_and_RunContext
        
        action			ComposeContext
        element-label	"Compose Context"
        case			default step-type "null" action-type COMPOSE
        with-inputs		between_Start_and_ComposeContext
        produces-outputs	between_ComposeContext_and_RunContext suppress(between_ComposeContext_and_RunContext.id)
        updates:
            between_ComposeContext_and_RunContext := between_Start_and_ComposeContext
        
        action			RunLocal
        element-label	"Run Local"
        case			default step-type "ProducerRunType" action-type RUN
        with-inputs		between_ComposeLocal_and_RunLocal, message, configuration
        with-guard		configuration.id == message.id
        produces-outputs	between_RunLocal_and_Compose suppress(between_RunLocal_and_Compose.id)
        updates:
            between_RunLocal_and_Compose := between_ComposeLocal_and_RunLocal
        
        action			Start
        element-label	"Start"
        case			default
        with-inputs		Event_1p0urs4
        produces-outputs	between_Start_and_ComposeContext suppress(between_Start_and_ComposeContext.id)
        updates:
            between_Start_and_ComposeContext := Event_1p0urs4
        
        action			ComposeLocal
        element-label	"Compose Local"
        case			default step-type "null" action-type COMPOSE
        with-inputs		between_RunContext_and_ComposeLocal
        produces-outputs	between_ComposeLocal_and_RunLocal suppress
        updates:
            between_ComposeLocal_and_RunLocal := between_RunContext_and_ComposeLocal
        produces-outputs	message symbolic-link suppress(message.id)
    
        element-labels ["ContextIssue", "Producer"]
    }
    
    system ContextIssueConsumer
    {
        inputs
        ProdCons1	part1
        ProdCons2	part2
        
        //outputs
    
        local
        
        UNIT	Event_0fmv4m5
    
        // init
    
    
        desc "ContextIssueConsumer_Model"
        
        action			ConsumerRun
        element-label	"Consumer Run"
        case			default step-type "ConsumerRunType" action-type RUN
        with-inputs		part1, part2
        with-guard		part1.id == part2.id
        produces-outputs	Event_0fmv4m5 suppress
    
        element-labels ["ContextIssue", "Consumer"]
    }
    
	SUT-blocks ContextIssueConsumer ContextIssueProducer ContextIssueProducer
	depth-limits 300
	num-tests 1
}
