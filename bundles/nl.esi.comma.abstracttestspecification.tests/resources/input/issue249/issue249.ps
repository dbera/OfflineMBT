import "issue249.types"
specification issue249
{
    system ContextIssueProducer
    {
        //inputs
        
        outputs
        ProdCons1		part1
        ProdCons2		part2
    
        local
        ProdCtx	sutConf
        ProdReport	report
        ProdCons1	message
        ProdCtx	configuration
        ProdCtx	Gateway_1ww9hic
        ProdCtx	Gateway_1ywuak3
        ProdCtx	Event_1p0urs4
        ProdCtx	Event_0m7n0r6
        ProdCtx	between_RunLocal_and_Compose
    
        init
        Event_1p0urs4 := ProdCtx {
         prod_field = "Hello Consumer!",
            loop = false,
         id = 0
        }
        sutConf := ProdCtx {
         prod_field = "sut",
         id = 0,
         loop = true
        }
        configuration := ProdCtx {
         prod_field = " Conf",
            loop = false,
         id = 0
        }
    
        suts sutConf
    
        desc "ContextIssueProducer_Model"
        
        action			Compose
        element-label	"Compose"
        case			default step-type "null" action-type COMPOSE
        with-inputs		between_RunLocal_and_Compose
        produces-outputs	Event_0m7n0r6 suppress(Event_0m7n0r6.id, Event_0m7n0r6.loop)
        updates:
            Event_0m7n0r6 := between_RunLocal_and_Compose
        produces-outputs	part1 symbolic-link suppress(part1.id)
        updates:
            part1 := ProdCons1 {
             part1 = between_RunLocal_and_Compose.prod_field + "_1",
             id = between_RunLocal_and_Compose.id
            }
        produces-outputs	report
        updates:
            report := ProdReport { id = between_RunLocal_and_Compose.id }
        produces-outputs	part2 symbolic-link suppress(part2.id)
        updates:
            part2 := ProdCons2 {
             part2 = between_RunLocal_and_Compose.prod_field + "_2",
             id = between_RunLocal_and_Compose.id
            }
        
        action			Loop
        element-label	"Loop"
        case			default
        with-inputs		Gateway_1ww9hic
        with-guard		Gateway_1ww9hic.loop
        produces-outputs	Gateway_1ywuak3 suppress(Gateway_1ywuak3.loop, Gateway_1ywuak3.id)
        updates:
            Gateway_1ywuak3 := Gateway_1ww9hic
            Gateway_1ywuak3.loop := false
        
        action			RunLocal
        element-label	"Run Local"
        case			default step-type "ProducerRunType" action-type RUN
        with-inputs		Gateway_1ww9hic, message, configuration, sutConf
        with-guard		not Gateway_1ww9hic.loop and configuration.id == message.id
        produces-outputs	between_RunLocal_and_Compose suppress(between_RunLocal_and_Compose.loop, between_RunLocal_and_Compose.id)
        updates:
            between_RunLocal_and_Compose := Gateway_1ww9hic
        
        action			Start
        element-label	"Start"
        case			default
        with-inputs		Event_1p0urs4
        produces-outputs	Gateway_1ywuak3 suppress(Gateway_1ywuak3.loop, Gateway_1ywuak3.id)
        updates:
            Gateway_1ywuak3 := Event_1p0urs4
        
        action			ComposeLocal
        element-label	"Compose Local"
        case			default step-type "null" action-type COMPOSE
        with-inputs		Gateway_1ywuak3
        produces-outputs	Gateway_1ww9hic suppress
        updates:
            Gateway_1ww9hic := Gateway_1ywuak3
        produces-outputs	message symbolic-link suppress(message.id)
        updates:
            message := ProdCons1 {
             part1 = "Hello Message!",
             id = Gateway_1ywuak3.id
            }
    
        element-labels ["ContextIssue", "Producer"]
    }
    
    system ContextIssueConsumer
    {
        inputs
        ProdCons1	part1
        ProdCons2	part2
        
        //outputs
    
        local
        
        UNIT	Event_0fmv4m5
    
        // init
    
    
        desc "ContextIssueConsumer_Model"
        
        action			ConsumerRun
        element-label	"Consumer Run"
        case			default step-type "ConsumerRunType" action-type RUN
        with-inputs		part1, part2
        with-guard		part1.id == part2.id
        produces-outputs	Event_0fmv4m5 suppress
    
        element-labels ["ContextIssue", "Consumer"]
    }
    
	SUT-blocks ContextIssueConsumer ContextIssueProducer
	depth-limits 15000
	num-tests 1
}
